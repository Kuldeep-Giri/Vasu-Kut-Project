<app-spinner *ngIf="loading"></app-spinner>

<div class="container-fluid mt-3">
  <div class="p-4">
    <h3 class="fw-bold mb-1 fs-4">Product Listings</h3>
    <p class="text-muted mb-2 fs-6">
      Manage your Approved, Rejected, and all products in one place.
    </p>
  </div>

  <!-- Search & Filter Section -->
  <div class="d-flex flex-wrap gap-2 justify-content-between mb-3 filter-container">
    <!-- Search Input -->
    <div class="search-box">
      <div class="input-group">
        <input type="text" class="form-control" placeholder="Search by product" [(ngModel)]="searchText" />
        <button class="btn btn-success" type="button" (click)="onFilterChange()">Search</button>
      </div>
    </div>

    <!-- Status Dropdown -->
    <div class="status-dropdown">
      <select class="form-select" [(ngModel)]="filterStatus" (change)="onFilterChange()">
        <option value="all">All Status</option>
        <option value="1">Approved</option>
        <option value="0">Pending</option>
      </select>
    </div>
  </div>

  <!-- Responsive Table -->
  <div class="table-container">
    <table class="table table-striped table-bordered align-middle">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Description</th>
          <th>Images</th>
          <th>Video</th>
          <th>Approval</th>
          <th>Min Price</th>
          <th>Max Price</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let product of products">
          <td>{{ product.id }}</td>
          <td class="text-truncate" title="{{ product.name }}">
            {{ product.name | slice:0:32 }}{{ product.name.length > 32 ? '...' : '' }}
          </td>
          <td>
            <button class="btn btn-outline-primary btn-sm action-btn" (click)="openPopup(product.description, 'description')">
              <i class="bi bi-eye"></i> View
            </button>
          </td>
          <td>
            <button class="btn btn-outline-primary btn-sm action-btn" (click)="openPopup(product.productImageUrls, 'images')">
              <i class="bi bi-image"></i> View
            </button>
          </td>
          <td>
            <button class="btn btn-outline-secondary btn-sm action-btn" (click)="openPopup(product.productVideoUrl, 'video')">
              <i class="bi bi-play-circle"></i> Play
            </button>
          </td>
          <td>
            <span class="badge bg-success" *ngIf="product.isApproved">Approved</span>
            <span class="badge bg-warning text-dark" *ngIf="!product.isApproved">Pending</span>
          </td>
          <td>{{ product.minPricePerUnit }}</td>
          <td>{{ product.maxPricePerUnit }}</td>
          <td>
            <div class="dropdown">
              <button class="btn btn-sm btn-light dropdown-toggle action-btn" type="button" data-bs-toggle="dropdown">
                <i class="bi bi-three-dots-vertical"></i>
              </button>
              <ul class="dropdown-menu">
                <li *ngIf="!product.isApproved">
                  <button class="dropdown-item text-success" (click)="IsApproved(product.id, 'app')">
                    <i class="bi bi-check-circle-fill"></i> Approve
                  </button>
                </li>
                <li>
                  <button class="dropdown-item text-danger" (click)="IsApproved(product.id, 'reject')">
                    <i class="bi bi-x-circle-fill"></i> Reject
                  </button>
                </li>
              </ul>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
<div class="text-center mt-5" *ngIf="!products.length && !loading">
  No product Find
</div>